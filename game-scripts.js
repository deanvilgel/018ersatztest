pc.DEFAULT_HUMAN_HEIGHT=1.67,function(){pc.util={},pc.util.DEBUG=!1,pc.util.DEFAULT_VEC3_0=new pc.Vec3(0,0,0),pc.util.DEFAULT_VEC3_1=new pc.Vec3(1,1,1),pc.util.DEFAULT_QUAT=new pc.Quat(0,0,0,1),pc.util.HIGHLIGHT_ENTITY_GREEN=new pc.Color(.25,.5,.25),pc.util.HIGHLIGHT_ENTITY_RED=new pc.Color(.25,.125,.125),pc.util.HIGHLIGHT_ENTITY_DEFAULT=new pc.Color(0,0,0),pc.util.setEntityAlpha=function(t,n){for(var e=pc.math.clamp(n,0,1),r=pc.util.getMeshInstances(t),i=0;i<r.length;++i)r[i].setParameter("material_opacity",e)},pc.util.setEntityEmissive=function(t,n){for(var e=pc.util.getMeshInstances(t),r=0;r<e.length;++r)e[r].setParameter("material_emissive",n.data3)},pc.util.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},pc.util.canPlayOgg=function(){var t=navigator.userAgent.toLowerCase();return!(t.search("safari")>=0&&t.search("chrome")<0)},pc.util.unitCurve=function(t,n){if(1==n)return t;var e=t,r=n-n*e+e;return 0!==r&&(e/=r),e},pc.util.sCurve=function(t){return t*t*(3-2*t)},pc.util.playSoundSlot=function(t,n,e){if(t.sound){var r=t.sound.slots[n];return r&&(e&&(r.volume=e),r.play()),r}return null},pc.util.stopSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.stop(),e}return null},pc.util.pauseSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.pause(),e}return null},pc.util.isPlayingSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];if(e)return e.isPlaying}return!1},pc.util.initSoundSlotAssets=function(t,n){var e=pc.util.canPlayOgg()?".ogg":".mp3",r=n.sound?n.sound.slots:null,i=0;if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=t.assets.find(o+e,"audio");s&&(r[o].asset=s.id,i+=1)}return i};var t=new pc.Vec3;pc.util.getYaw=function(n){var e=t;return n.transformVector(pc.Vec3.FORWARD,e),Math.atan2(-e.x,-e.z)*pc.math.RAD_TO_DEG};var n=new pc.Quat,e=new pc.Quat;pc.util.angleBetweenQuats=function(t,r){var i=n.copy(t).invert(),o=e.mul2(r,i),s=2*Math.acos(pc.math.clamp(o.w,-1,1))*pc.math.RAD_TO_DEG;return s>180&&(s=360-s),s},pc.util.clampQuatToYAxis=function(t){t.x=0,t.z=0;var n=Math.sqrt(t.w*t.w+t.y*t.y);t.w/=n,t.y/=n},pc.util.getMeshInstances=function(t){if(t.model)return t.model.meshInstances;var n=[];if(t instanceof pc.Entity)for(var e=t.findComponents("render"),r=0;r<e.length;++r)for(var i=e[r].meshInstances,o=0;o<i.length;o++)n.push(i[o]);return n}}(),pc.extend(pc,function(){var t=function OrientatedBox(t,n){this.halfExtents=t||new pc.Vec3(.5,.5,.5),this._worldTransform=n||new pc.Mat4,this._modelTransform=this._worldTransform.clone().invert(),this._aabb=new pc.BoundingBox(new pc.Vec3,this.halfExtents)},n=new pc.Ray,e=new pc.Vec3,r=new pc.BoundingSphere;return t.prototype={intersectsRay:function(t,e){if(this._modelTransform.transformPoint(t.origin,n.origin),this._modelTransform.transformVector(t.direction,n.direction),e){var r=this._aabb._intersectsRay(n,e);return this._worldTransform.transformPoint(e,e),r}return modelBox._fastIntersectsRay(this._transformedRay)},containsPoint:function(t){return this._modelTransform.transformPoint(t,e),this._aabb.containsPoint(e)},intersectsBoundingSphere:function(t){return this._modelTransform.transformPoint(t.center,r.center),r.radius=t.radius,!!this._aabb.intersectsBoundingSphere(r)}},Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this._worldTransform},set:function(t){this._worldTransform=t,this._modelTransform.copy(this._worldTransform).invert()}}),{OrientatedBox:t}}()),pc.BoundingSphere.diffBetweenPoints=new pc.Vec3,pc.BoundingSphere.prototype.intersectsBoundingSphere=function(t){var n=pc.BoundingSphere.diffBetweenPoints;n.sub2(t.center,this.center);var e=t.radius+this.radius;return n.lengthSq()<=e*e},pc.BoundingBox.prototype._distanceToBoundingSphereSq=function(t){for(var n=this.getMin(),e=this.getMax(),r=0,i=0;i<3;++i){var o=0,s=t.center.data[i],a=n.data[i],u=e.data[i],c=0;s<a&&(o+=(c=a-s)*c),s>u&&(o+=(c=s-u)*c),r+=o}return r},pc.BoundingBox.prototype.intersectsBoundingSphere=function(t){return this._distanceToBoundingSphereSq(t)<=t.radius*t.radius};var meta=document.querySelector("meta[name=viewport]");meta.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover");document.addEventListener("contextmenu",(function(e){e.preventDefault()}));var VirtualJoystick=pc.createScript("virtualJoystick");VirtualJoystick.attributes.add("stick",{type:"entity"}),VirtualJoystick.attributes.add("enableEvent",{type:"string"}),VirtualJoystick.attributes.add("moveEvent",{type:"string"}),VirtualJoystick.attributes.add("disableEvent",{type:"string"}),VirtualJoystick.prototype.initialize=function(){var t=this.app;t.on(this.enableEvent,(function(t,i){this.entity.setLocalPosition(t,-i,0),this.stick.setLocalPosition(t,-i,0),this.entity.element.enabled=!0,this.stick.element.enabled=!0}),this),t.on(this.moveEvent,(function(t,i){this.stick.setLocalPosition(t,-i,0)}),this),t.on(this.disableEvent,(function(){this.entity.element.enabled=!1,this.stick.element.enabled=!1}),this)};var Ui=pc.createScript("ui");Ui.attributes.add("html",{type:"asset",assetType:"html"}),Ui.attributes.add("css",{type:"asset",assetType:"css"}),Ui.prototype.initialize=function(){this.fixedHtml="",this.fixedCss="",this.fixUp(),this.createCss(),this.createHtml(),this.initUi()},Ui.prototype.fixUp=function(){this.fixedHtml=this.html.resource,this.fixedCss=this.css.resource,this.app.assets.findByTag("ui").forEach(function(e){var t=new RegExp(e.name,"gi"),n=e.getFileUrl();this.fixedHtml=this.fixedHtml.replace(t,n),this.fixedCss=this.fixedCss.replace(t,n)}.bind(this))},Ui.prototype.createCss=function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=this.fixedCss,this.css.on("load",(function(){this.fixUp(),e.innerHTML=this.fixedCss}),this),document.getElementsByTagName("head")[0].appendChild(e)},Ui.prototype.createHtml=function(){var e=document.createElement("div");e.innerHTML=this.fixedHtml,this.html.on("load",(function(){this.fixUp(),e.innerHTML=this.fixedHtml,this.initUi()}),this),document.body.appendChild(e)},Ui.prototype.initUi=function(){var e=this.app;["logo"].forEach((function(e){el=document.getElementById(e),el.addEventListener("mousedown",(function(e){e.stopPropagation()})),el.addEventListener("touchstart",(function(e){e.stopPropagation()}))})),["fullscreen-button"].forEach((function(e){el=document.getElementById(e),el.addEventListener("mousedown",(function(e){e.stopPropagation()})),el.addEventListener("touchstart",(function(e){e.stopPropagation()}))})),["camera-button"].forEach((function(e){el=document.getElementById(e),el.addEventListener("mousedown",(function(e){e.stopPropagation()})),el.addEventListener("touchstart",(function(e){e.stopPropagation()}))})),["stop-button"].forEach((function(e){el=document.getElementById(e),el.addEventListener("mousedown",(function(e){e.stopPropagation()})),el.addEventListener("touchstart",(function(e){e.stopPropagation()}))})),["vr-button"].forEach((function(e){el=document.getElementById(e),el.addEventListener("mousedown",(function(e){e.stopPropagation()})),el.addEventListener("touchstart",(function(e){e.stopPropagation()}))})),el=document.getElementById("fullscreen-button"),document.documentElement.requestFullscreen?el.addEventListener("click",(function(e){el.classList.contains("checked")?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen(),el.classList.toggle("checked")})):el.classList.add("hidden"),el=document.getElementById("camera-button"),el.addEventListener("click",(function(t){if(console.log(el),e.root.findByName("02_Models").enabled){el.classList.toggle("checked");var n=e.root.findByName("WalkPlayer"),i=e.root.findByName("FlyCamera");e.root.findByName("FlyCamera").enabled?(i.script.enabled=!1,n.findByName("WalkCamera").script.enabled=!0):(i.script.enabled=!0,n.findByName("WalkCamera").script.enabled=!1),n.enabled=!n.enabled,i.enabled=!i.enabled,e.root.findByName("FlyCamera").script.orbitCamera.reset(e.root.findByName("FlyCamera").script.KeyboardInputFly.startYaw,e.root.findByName("FlyCamera").script.KeyboardInputFly.startPitch,e.root.findByName("FlyCamera").script.KeyboardInputFly.startDistance),e.root.findByName("FlyCamera").script.orbitCamera.pivotPoint=e.root.findByName("FlyCamera").script.KeyboardInputFly.startPivotPosition}}));let t=0;el=document.getElementById("stop-button"),console.log(e.assets.get(118350817)),console.log(e.assets.get(118350818)),el.addEventListener("click",(function(n){t=1-t,e.fire("movestop"),document.getElementById("stop-button").children[0].src=0==t?e.assets.get(118350818).getFileUrl():e.assets.get(118350817).getFileUrl()})),el=document.getElementById("vr-button"),el.addEventListener("click",(function(t){Vrstate=e.root.findByName("VrState"),Vrstate.enabled=!Vrstate.enabled,e.xr&&!e.xr.active&&e.xr.isAvailable(pc.XRTYPE_VR)&&(e.root.findByName("FlyCamera").enabled?(e.root.findByName("FlyCamera").script.enabled=!1,e.root.findByName("VR Camera").script.enabled=!0):(e.root.findByName("FlyCamera").script.enabled=!0,e.root.findByName("VR Camera").script.enabled=!1),e.root.findByName("A_PC_Mobile").enabled=!1,e.root.findByName("B_VR").enabled=!0,Vrstate.script.vr.sessionStart())}))};var KeyboardInputFly=pc.createScript("KeyboardInputFly");KeyboardInputFly.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInputFly.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInputFly.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_BACKSPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var TouchInputFly=pc.createScript("TouchInputFly");TouchInputFly.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInputFly.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInputFly.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInputFly.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInputFly.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInputFly.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInputFly.fromWorldPoint=new pc.Vec3,TouchInputFly.toWorldPoint=new pc.Vec3,TouchInputFly.worldDiff=new pc.Vec3,TouchInputFly.prototype.pan=function(t){var i=TouchInputFly.fromWorldPoint,o=TouchInputFly.toWorldPoint,n=TouchInputFly.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInputFly.pinchMidPoint=new pc.Vec2,TouchInputFly.prototype.onTouchMove=function(t){var i=TouchInputFly.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInputFly=pc.createScript("MouseInputFly");MouseInputFly.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInputFly.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInputFly.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInputFly.fromWorldPoint=new pc.Vec3,MouseInputFly.toWorldPoint=new pc.Vec3,MouseInputFly.worldDiff=new pc.Vec3,MouseInputFly.prototype.pan=function(t){var o=MouseInputFly.fromWorldPoint,e=MouseInputFly.toWorldPoint,i=MouseInputFly.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInputFly.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInputFly.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInputFly.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInputFly.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInputFly.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var CharacterController=pc.createScript("characterController");CharacterController.attributes.add("speed",{type:"number",default:5}),CharacterController.attributes.add("jumpImpulse",{type:"number",default:400}),CharacterController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,-1.1,0),this.rayEnd=new pc.Vec3,this.groundNormal=new pc.Vec3,this.onGround=!0,this.jumping=!1},CharacterController.prototype.move=function(t){if(this.onGround&&!this.jumping){var e=new pc.Vec3,i=t.length();i>0&&(e.cross(this.groundNormal,t).cross(e,this.groundNormal),e.normalize().scale(i*this.speed)),this.entity.rigidbody.linearVelocity=e}},CharacterController.prototype.jump=function(){this.onGround&&!this.jumping&&(this.entity.rigidbody.applyImpulse(0,this.jumpImpulse,0),this.onGround=!1,this.jumping=!0,setTimeout(function(){this.jumping=!1}.bind(this),500))},CharacterController.prototype.update=function(t){var e=this.entity.getPosition();this.rayEnd.add2(e,this.groundCheckRay);var i=this.app.systems.rigidbody.raycastFirstByTag(e,this.rayEnd,"Physical");this.onGround=!!i,i&&this.groundNormal.copy(i.normal)};var FirstPersonCamera=pc.createScript("firstPersonCamera");FirstPersonCamera.attributes.add("camera",{title:"Camera",description:"The camera controlled by this first person view. It should be a child of the entity to which this script is assigned. If no camera is assigned, the script will create one for you.",type:"entity"}),FirstPersonCamera.prototype.initialize=function(){var t=this.app;this.camera||(this.camera=this.entity.findByName("Camera"),this.camera||(this.camera=new pc.Entity("FPS Camera"),this.camera.addComponent("camera"))),this.x=new pc.Vec3,this.z=new pc.Vec3,this.heading=new pc.Vec3,this.magnitude=new pc.Vec2,this.azimuth=0,this.elevation=0;var e=this.camera.forward.clone();e.y=0,e.normalize(),this.azimuth=Math.atan2(-e.x,-e.z)*(180/Math.PI),(new pc.Mat4).setFromAxisAngle(pc.Vec3.UP,-this.azimuth).transformVector(this.camera.forward,e),this.elevation=Math.atan(e.y,e.z)*(180/Math.PI),this.forward=0,this.strafe=0,this.jump=!1,this.cnt=0,t.on("firstperson:forward",(function(t){this.forward=t}),this),t.on("firstperson:strafe",(function(t){this.strafe=t}),this),t.on("firstperson:look",(function(t,e){this.azimuth+=t,this.elevation+=e,this.elevation=pc.math.clamp(this.elevation,-90,90)}),this),t.on("firstperson:jump",(function(){this.jump=!0}),this)},FirstPersonCamera.prototype.postUpdate=function(t){this.camera.setEulerAngles(this.elevation,this.azimuth,0),this.z.copy(this.camera.forward),this.z.y=0,this.z.normalize(),this.x.copy(this.camera.right),this.x.y=0,this.x.normalize(),this.heading.set(0,0,0),0!==this.forward&&(this.z.scale(this.forward),this.heading.add(this.z)),0!==this.strafe&&(this.x.scale(this.strafe),this.heading.add(this.x)),this.heading.length()>1e-4&&(this.magnitude.set(this.forward,this.strafe),this.heading.normalize().scale(this.magnitude.length())),this.jump&&(this.entity.script.characterController.jump(),this.jump=!1),this.entity.script.characterController.move(this.heading);var e=this.camera.getPosition();this.app.fire("cameramove",e)};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){var t=this.app,updateMovement=function(e,i){switch(e){case 38:case 87:t.fire("firstperson:forward",i);break;case 40:case 83:t.fire("firstperson:forward",-i);break;case 37:case 65:t.fire("firstperson:strafe",-i);break;case 39:case 68:t.fire("firstperson:strafe",i)}},keyDown=function(e){e.repeat||(updateMovement(e.keyCode,1),32===e.keyCode&&t.fire("firstperson:jump"))},keyUp=function(t){updateMovement(t.keyCode,0)},addEventListeners=function(){window.addEventListener("keydown",keyDown,!0),window.addEventListener("keyup",keyUp,!0)};this.on("enable",addEventListeners),this.on("disable",(function(){window.addEventListener("keydown",keyDown,!0),window.addEventListener("keyup",keyUp,!0)})),addEventListeners()};var MouseInput=pc.createScript("mouseInput");function applyRadialDeadZone(t,e,i,s){var a=t.length();if(a>i){var r=1-s-i,n=Math.min(1,(a-i)/r)/a;e.copy(t).scale(n)}else e.set(0,0)}MouseInput.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),MouseInput.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),MouseInput.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3,this.on("enable",this.onEnable,this),this.on("disable",this.onDisable,this),this.onEnable()},MouseInput.prototype.onEnable=function(){this.app.mouse.on("mousemove",this._onMouseMove,this)},MouseInput.prototype.onDisable=function(){this.app.mouse.off("mousemove",this._onMouseMove,this)},MouseInput.prototype.update=function(t){this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},MouseInput.prototype._onMouseMove=function(t){if(pc.Mouse.isPointerLocked()||t.buttons[0]){var e=t.dx,i=t.dy;this.app.fire("firstperson:look",-e/5,-i/5)}};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("deadZone",{title:"Dead Zone",description:"Radial thickness of inner dead zone of the virtual joysticks. This dead zone ensures the virtual joysticks report a value of 0 even if a touch deviates a small amount from the initial touch.",type:"number",min:0,max:.4,default:.3}),TouchInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:150}),TouchInput.attributes.add("radius",{title:"Radius",description:"The radius of the virtual joystick in CSS pixels.",type:"number",default:50}),TouchInput.attributes.add("doubleTapInterval",{title:"Double Tap Interval",description:"The time in milliseconds between two taps of the right virtual joystick for a double tap to register. A double tap will trigger a jump.",type:"number",default:300}),TouchInput.prototype.initialize=function(){var t=this.app,e=t.graphicsDevice,i=e.canvas;this.remappedPos=new pc.Vec2,this.leftStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.lastRightTap=0;var s=function(s){s.preventDefault();for(var a=e.width/i.clientWidth,r=e.height/i.clientHeight,n=s.changedTouches,o=0;o<n.length;o++){var h=n[o];if(h.pageX<=i.clientWidth/2&&-1===this.leftStick.identifier)this.leftStick.identifier=h.identifier,this.leftStick.center.set(h.pageX,h.pageY),this.leftStick.pos.set(0,0),t.fire("leftjoystick:enable",h.pageX*a,h.pageY*r);else if(h.pageX>i.clientWidth/2&&-1===this.rightStick.identifier){this.rightStick.identifier=h.identifier,this.rightStick.center.set(h.pageX,h.pageY),this.rightStick.pos.set(0,0),t.fire("rightjoystick:enable",h.pageX*a,h.pageY*r);var p=Date.now();p-this.lastRightTap<this.doubleTapInterval&&t.fire("firstperson:jump"),this.lastRightTap=p}}}.bind(this),a=function(s){s.preventDefault();for(var a=e.width/i.clientWidth,r=e.height/i.clientHeight,n=s.changedTouches,o=0;o<n.length;o++){var h=n[o];h.identifier===this.leftStick.identifier?(this.leftStick.pos.set(h.pageX,h.pageY),this.leftStick.pos.sub(this.leftStick.center),this.leftStick.pos.scale(1/this.radius),t.fire("leftjoystick:move",h.pageX*a,h.pageY*r)):h.identifier===this.rightStick.identifier&&(this.rightStick.pos.set(h.pageX,h.pageY),this.rightStick.pos.sub(this.rightStick.center),this.rightStick.pos.scale(1/this.radius),t.fire("rightjoystick:move",h.pageX*a,h.pageY*r))}}.bind(this),r=function(e){e.preventDefault();for(var i=e.changedTouches,s=0;s<i.length;s++){var a=i[s];a.identifier===this.leftStick.identifier?(this.leftStick.identifier=-1,t.fire("firstperson:forward",0),t.fire("firstperson:strafe",0),t.fire("leftjoystick:disable")):a.identifier===this.rightStick.identifier&&(this.rightStick.identifier=-1,t.fire("rightjoystick:disable"))}}.bind(this),addEventListeners=function(){i.addEventListener("touchstart",s,!1),i.addEventListener("touchmove",a,!1),i.addEventListener("touchend",r,!1)};this.on("enable",addEventListeners),this.on("disable",(function(){i.removeEventListener("touchstart",s,!1),i.removeEventListener("touchmove",a,!1),i.removeEventListener("touchend",r,!1)})),addEventListeners()},TouchInput.prototype.update=function(t){var e=this.app;if(-1!==this.leftStick.identifier){applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZone,0);var i=this.remappedPos.x;this.lastStrafe!==i&&(e.fire("firstperson:strafe",i),this.lastStrafe=i);var s=-this.remappedPos.y;this.lastForward!==s&&(e.fire("firstperson:forward",s),this.lastForward=s)}if(-1!==this.rightStick.identifier){applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZone,0);var a=-this.remappedPos.x*this.turnSpeed*t,r=-this.remappedPos.y*this.turnSpeed*t;e.fire("firstperson:look",a,r)}};var GamePadInput=pc.createScript("gamePadInput");GamePadInput.attributes.add("deadZoneLow",{title:"Low Dead Zone",description:"Radial thickness of inner dead zone of pad's joysticks. This dead zone ensures that all pads report a value of 0 for each joystick axis when untouched.",type:"number",min:0,max:.4,default:.2}),GamePadInput.attributes.add("deadZoneHigh",{title:"High Dead Zone",description:"Radial thickness of outer dead zone of pad's joysticks. This dead zone ensures that all pads can reach the -1 and 1 limits of each joystick axis.",type:"number",min:0,max:.4,default:.2}),GamePadInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:150}),GamePadInput.prototype.initialize=function(){this.lastStrafe=0,this.lastForward=0,this.lastJump=!1,this.remappedPos=new pc.Vec2,this.leftStick={center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={center:new pc.Vec2,pos:new pc.Vec2};var addEventListeners=function(){window.addEventListener("gamepadconnected",(function(t){})),window.addEventListener("gamepaddisconnected",(function(t){}))};this.on("enable",addEventListeners),this.on("disable",(function(){window.removeEventListener("gamepadconnected",(function(t){})),window.removeEventListener("gamepaddisconnected",(function(t){}))})),addEventListeners()},GamePadInput.prototype.update=function(t){for(var e=this.app,i=navigator.getGamepads?navigator.getGamepads():[],s=0;s<i.length;s++){var a=i[s];if(a&&"standard"===a.mapping&&a.axes.length>=4){this.leftStick.pos.set(a.axes[0],a.axes[1]),applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var r=this.remappedPos.x;this.lastStrafe!==r&&(e.fire("firstperson:strafe",r),this.lastStrafe=r);var n=-this.remappedPos.y;this.lastForward!==n&&(e.fire("firstperson:forward",n),this.lastForward=n),this.rightStick.pos.set(a.axes[2],a.axes[3]),applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var o=-this.remappedPos.x*this.turnSpeed*t,h=-this.remappedPos.y*this.turnSpeed*t;e.fire("firstperson:look",o,h),a.buttons[0].pressed&&!this.lastJump&&e.fire("firstperson:jump"),this.lastJump=a.buttons[0].pressed}}};ShapeWorld=pc.createScript("shapeWorld"),ShapeWorld.prototype.initialize=function(){this._pickableEntities=[],this._pickableShapes=[],this.app.on("shapeworld:add",this.addItem,this),this.app.on("shapeworld:remove",this.removeItem,this),this.app.shapeWorld=this},ShapeWorld.hitPoint=new pc.Vec3,ShapeWorld.vecBetween=new pc.Vec3,ShapeWorld.prototype.raycast=function(e,t,i,p){for(var a=ShapeWorld.hitPoint,s=(ShapeWorld.vecBetween,p||1/0),h=null,n=0;n<this._pickableShapes.length;++n){var r=this._pickableShapes[n],o=this._pickableEntities[n];if((!t||t(o)&&o.enabled)&&r.intersectsRay(e,a)){var l=e.origin.distance(a);l<s&&(s=l,h=o,i&&i.copy(a))}}return h},ShapeWorld.prototype.containsPoint=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.containsPoint(e)){i=s;break}}return i},ShapeWorld.prototype.intersectsSphere=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.intersectsBoundingSphere(e)){i=s;break}}return i},ShapeWorld.prototype.addItem=function(e,t){e&&(this._pickableEntities.push(e),this._pickableShapes.push(t))},ShapeWorld.prototype.removeItem=function(e){var t=this._items.indexOf(e);t>=0&&(this._pickableEntities.splice(t,1),this._pickableShapes.splice(t,1))};var Shape=pc.createScript("shape");Shape.attributes.add("type",{type:"string",enum:[{Sphere:"sphere"},{AABB:"aabb"},{OBB:"obb"}],default:"sphere",title:"Type"}),Shape.attributes.add("childOfActualEntity",{type:"boolean",default:!1,title:"Child Of Actual Entity",description:"Tick if the shape is a child of the actual entity object"}),Shape.attributes.add("keepUpdating",{type:"boolean",default:!1,title:"Keep Updating",description:"Update the shape data every frame (only toggle if the entity moves as can be expensive)"}),Shape.attributes.add("addToObject",{type:"string",enum:[{Global:"app"},{"Actual Entity":"actualEntity"}],title:"Add to Object",default:"app"}),Shape.prototype.initialize=function(){switch(this._halfExtents=this.entity.getLocalScale().clone().scale(.5),this.type){case"sphere":this._shape=new pc.BoundingSphere(this.entity.getPosition().clone(),Math.max(this._halfExtents.x,Math.max(this._halfExtents.y,this._halfExtents.z)));break;case"aabb":this._shape=new pc.BoundingBox(this.entity.getPosition().clone(),this._halfExtents);break;case"obb":this._worldTransform=(new pc.Mat4).setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape=new pc.OrientatedBox(this._halfExtents,this._worldTransform)}},Shape.prototype.postInitialize=function(){this._getAddToObject().fire("shapeworld:add",this._getActualEntity(),this._shape)},Shape.prototype.update=function(t){if(this.keepUpdating)switch(this.type){case"sphere":case"aabb":this._shape.center.copy(this.entity.getPosition());break;case"obb":this._worldTransform.setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape.worldTransform=this._worldTransform}},Shape.prototype._getAddToObject=function(){switch(this.addToObject){case"app":return this.app;case"actualEntity":return this._getActualEntity();default:return null}},Shape.prototype._getActualEntity=function(){return this.childOfActualEntity?this.entity.parent:this.entity};pc.extend(pc,function(){var HueSaturationEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","float angle = uHue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (uSaturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","}","}"].join("\n")}),this.hue=0,this.saturation=0};return(HueSaturationEffect=pc.inherits(HueSaturationEffect,pc.PostEffect)).prototype=pc.extend(HueSaturationEffect.prototype,{render:function(t,e,r){var o=this.device,a=o.scope;a.resolve("uHue").setValue(this.hue),a.resolve("uSaturation").setValue(this.saturation),a.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,r)}}),{HueSaturationEffect:HueSaturationEffect}}());var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,precision:5,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new pc.HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var Vr=pc.createScript("vr");Vr.attributes.add("elementUnsupported",{type:"entity",title:"Unsupported Message"}),Vr.attributes.add("elementUnavailable",{type:"entity",title:"Unavailable Message"}),Vr.attributes.add("elementHttpsRequired",{type:"entity",title:"HTTPS Required Message"}),Vr.attributes.add("cameraEntity",{type:"entity",title:"Camera"}),Vr.prototype.initialize=function(){this.app.keyboard.on("keydown",(function(e){e.key===pc.KEY_ESCAPE&&this.app.xr.active&&this.app.xr.end()}),this),this.errorMessage(),this.app.xr.on("end",(function(){this.app.root.findByName("FlyCamera").enabled?(this.app.root.findByName("FlyCamera").script.enabled=!1,this.app.root.findByName("VR Camera").script.enabled=!0):(this.app.root.findByName("FlyCamera").script.enabled=!0,this.app.root.findByName("VR Camera").script.enabled=!1),this.app.root.findByName("A_PC_Mobile").enabled=!0,this.app.root.findByName("B_VR").enabled=!1}))},Vr.prototype.errorMessage=function(){if(this.app.xr.supported){if(this.elementHttpsRequired.enabled=!1,this.elementUnsupported.enabled=!1,this.elementUnavailable.enabled=!1,!this.app.xr.active)var e=this.app.xr&&!this.app.xr.active&&this.app.xr.isAvailable(pc.XRTYPE_VR);e||(this.elementUnavailable.enabled=!0)}else this.elementUnavailable.enabled=!1,"https:"==window.location.protocol?(this.elementUnsupported.enabled=!0,this.elementHttpsRequired.enabled=!1):(this.elementUnsupported.enabled=!1,this.elementHttpsRequired.enabled=!0)},Vr.prototype.sessionStart=function(){this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){"granted"===e&&window.addEventListener("deviceorientation",function(e){this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)}.bind(this))}.bind(this)).catch(console.error):this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)))};!function(){var t=new pc.Vec3;pc.RigidBodyComponentSystem.prototype.raycastFirstByTag=function(n,r,a){for(var e=Number.MAX_VALUE,i=null,s=this.app.systems.rigidbody.raycastAll(n,r),o=0;o<s.length;++o){var y=s[o];if(y.entity.tags.has(a)){t.sub2(y.point,n);var p=t.lengthSq();p<e&&(e=p,i=y)}}return i}}();var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseSensivity",{title:"Mouse Sensivity",type:"number",default:.3}),LookCamera.attributes.add("controllerTemplate",{title:"Controller Template",type:"asset",assetType:"template"}),LookCamera.prototype.initialize=function(){this._offsetParent=this.entity.parent;var t=this.entity.getRotation();this.yaw=pc.util.getYaw(t),this.pitch=this._getPitch(t,this.yaw),this.movedMouse=0,this.movedStart=0,this.touchCoords=new pc.Vec2,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.disableContextMenu(),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this._onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this)),this.app.mainCamera=this.entity,this.gazeController=null,this.app.xr.active||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0),this.app.xr.on("start",(function(){this.gazeController&&(this.gazeController.destroy(),this.gazeController=null)}),this),this.app.xr.on("end",(function(){this.gazeController||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0)}),this)},LookCamera.prototype._onMouseDown=function(t){this.app.xr.active||t.button===pc.MOUSEBUTTON_LEFT&&(this.movedStart=Date.now(),this.movedMouse=0,this.gazeController&&this.gazeController.script.controller.onSelectStart())},LookCamera.prototype._onTouchStart=function(t){this.app.xr.active||(t.event.preventDefault(),1===t.touches.length&&(this.movedStart=Date.now(),this.movedMouse=0,this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController&&(this.gazeController.script.controller.active=!0,this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController.script.controller.onSelectStart())))},LookCamera.prototype._onMouseUp=function(t){this.app.xr.active||t.button===pc.MOUSEBUTTON_LEFT&&this.gazeController&&(!pc.Mouse.isPointerLocked()&&(this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0)},LookCamera.prototype._onTouchEndCancel=function(t){this.app.xr.active||0===t.touches.length&&this.gazeController&&((this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0,this.gazeController.script.controller.active=!1)},LookCamera.prototype._onMouseMove=function(t){this.app.xr.active||(this.gazeController&&(this.gazeController.script.controller.mouseCoords.set(t.x,t.y),this.gazeController.script.controller.active=!0),!pc.Mouse.isPointerLocked()&&(!this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)||this.gazeController&&this.gazeController.script.controller.getHeldEntity())||(this.pitch=Math.max(-90,Math.min(90,this.pitch-t.dy*this.mouseSensivity)),this.yaw-=t.dx*this.mouseSensivity,this.movedMouse+=Math.abs(t.dy)+Math.abs(t.dx)))},LookCamera.prototype._onTouchMove=function(t){if(!this.app.xr.active&&1===t.touches.length&&(this.gazeController&&this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),!this.gazeController||!this.gazeController.script.controller.getHeldEntity())){var o=t.touches[0].x-this.touchCoords.x,e=t.touches[0].y-this.touchCoords.y;this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.pitch=Math.max(-90,Math.min(90,this.pitch-e*this.mouseSensivity)),this.yaw-=o*this.mouseSensivity,this.movedMouse+=Math.abs(e)+Math.abs(o)}},LookCamera.prototype.update=function(t){this._offsetParent.setLocalEulerAngles(0,this.yaw,0),this.app.xr.active||this.entity.setLocalEulerAngles(this.pitch,0,0)},LookCamera.quatWithoutYaw=new pc.Quat,LookCamera.yawOffset=new pc.Quat,LookCamera.prototype._getPitch=function(t,o){var e=LookCamera.quatWithoutYaw,s=LookCamera.yawOffset;s.setFromEulerAngles(0,-o,0),e.mul2(s,t);var r=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,r),Math.atan2(r.y,-r.z)*pc.math.RAD_TO_DEG};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"asset",assetType:"template",title:"Controller Template"}),Controllers.prototype.initialize=function(){this.controllerAssets=this.app.assets.findByTag("controller"),this.controllerAssetsIndex={};for(var e=0;e<this.controllerAssets.length;e++){var t=this.controllerAssets[e].name.replace(/\.[a-z]+$/i,"");this.controllerAssetsIndex[t]=this.controllerAssets[e]}this.app.xr.input.on("add",(function(e){for(var t=this.controllerTemplate.resource.instantiate(),r=null,s=0;s<e.profiles.length;s++){var l=e.profiles[s]+"-"+e.handedness;if(r=this.controllerAssetsIndex[l])break}r||(r=this.controllerAssetsIndex["generic-trigger-"+(e.handedness||"none")]),t.reparent(this.app.root),t.script.controller.setInputSource(e,r),t.enabled=!0}),this)};var Controller=pc.createScript("controller");Controller.attributes.add("maxGrabDistance",{type:"number",title:"Max Grab Distance",default:.1}),Controller.prototype.initialize=function(){this.ray=new pc.Ray,this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.holdingEntity=null,this.teleportableEntity=null,this.hoverEntity=null,this.hoverPoint=new pc.Vec3,this.teleportable=!0,this.active=!0,this.mouseCoords=new pc.Vec2,this.holdingDistance=0,this.holdingOffset=new pc.Vec3,this.holdingNoOffset=!0,this.modelEntity=this.entity.findByName("Model"),this.grabAnchor=new pc.Entity,this.grabAnchor.reparent(this.entity)},Controller.prototype.setInputSource=function(t,i){var e=this;if(this.inputSource=t,this.inputSource.once("remove",this.onRemove,this),this.on("hover",this.onHover,this),this.on("blur",this.onBlur,this),this.inputSource.on("selectstart",this.onSelectStart,this),this.inputSource.on("selectend",this.onSelectEnd,this),t.hand){this.joints=[];for(var o=new pc.StandardMaterial,s=0;s<t.hand.joints.length;s++){var n=t.hand.joints[s],h=new pc.Entity;h.addComponent("model",{type:"box"}),h.joint=n,h.model.material=o,this.joints.push(h),this.entity.addChild(h)}t.hand.on("trackinglost",(function(){this.joints[0].model.material.diffuse.set(1,0,0),this.joints[0].model.material.update()}),this),t.hand.on("tracking",(function(){this.joints[0].model.material.diffuse.set(1,1,1),this.joints[0].model.material.update()}),this)}else i&&(i.ready((function(){if(this.entity.parent){var t=i.resource,o=new Blob([t]);this.app.assets.loadFromUrlAndFilename(URL.createObjectURL(o),"container.glb","container",(function(t,i){if(!e.entity.parent)return i.unload(),void e.app.assets.remove(i);t?console.error(t):(e.modelEntity.setLocalScale(1,1,1),e.modelEntity.model.type="asset",e.modelEntity.model.asset=i.resource.model,e.modelEntity.containerAsset=i)}))}}),this),this.app.assets.load(i))},Controller.prototype.onRemove=function(){this.modelEntity.containerAsset&&(console.log(this.modelEntity.containerAsset),this.modelEntity.containerAsset.unload(),this.app.assets.remove(this.modelEntity.containerAsset),this.modelEntity.containerAsset=null),this.entity.destroy()},Controller.prototype.onSelectStart=function(){this.pick(),this.teleportableEntity?this.app.xr.active&&(this.app.fire("teleport:to",this.hoverPoint),this.hoverEntity.fire("object:interact",this)):this.hoverEntity&&!this.holdingEntity&&this.hoverEntity.fire("object:hold",this)},Controller.prototype.onSelectEnd=function(){this.teleportableEntity&&!this.app.xr.active&&this.teleportable&&this.app.fire("teleport:to",this.hoverPoint),this.hoverEntity&&this.hoverEntity.fire("object:attemptuse",this),this.holdingEntity&&this.holdingEntity.fire("object:release",this)},Controller.prototype.getAttachPosition=function(){return this.grabAnchor.getPosition()},Controller.prototype.getAttachRotation=function(){return this.grabAnchor.getRotation()},Controller.prototype.attach=function(t){this.holdingEntity||(this.holdingEntity=t,this.grabAnchor.setPosition(t.getPosition()),this.holdingDistance=t.getPosition().distance(this.app.mainCamera.getPosition()))},Controller.prototype.detach=function(t){this.holdingEntity&&(this.holdingEntity=null)},Controller.prototype.getHeldEntity=function(){return this.holdingEntity},Controller.prototype.updateAttachment=function(t,i){t.setPosition(this.getAttachPosition()),this.quat.mul2(this.getAttachRotation(),i),t.setRotation(this.quat)},Controller.prototype.filterPicker=function(t){return this.holdingEntity!==t},Controller.prototype.pick=function(){this.inputSource?this.ray.set(this.inputSource.getOrigin(),this.inputSource.getDirection()):pc.Mouse.isPointerLocked()?this.ray.set(this.app.mainCamera.getPosition(),this.app.mainCamera.forward):(this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.nearClip,this.vecA),this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.farClip,this.vecB),this.vecB.sub(this.vecA).normalize(),this.ray.set(this.vecA,this.vecB),this.holdingEntity?(this.vecB.scale(this.holdingDistance),this.vecB.add(this.vecA),this.holdingNoOffset&&(this.holdingNoOffset=!1,this.holdingOffset.copy(this.grabAnchor.getPosition()).sub(this.vecB)),this.vecB.add(this.holdingOffset),this.grabAnchor.setPosition(this.vecB)):this.holdingNoOffset=!0);var t=this.app.shapeWorld.raycast(this.ray,this.filterPicker.bind(this),this.hoverPoint),i=!1;(this.active||(t=null),this.hoverEntity!==t&&(this.hoverEntity&&this.hoverEntity.fire("object:offhover",this),t&&t.fire("object:onhover",this),this.hoverEntity=t),this.hoverEntity)&&(this.holdingEntity||this.hoverEntity.tags.has("floor")&&this.hoverEntity.up.dot(this.ray.direction)<=0&&(i=!0));this.teleportableEntity=i?this.hoverEntity:null},Controller.prototype.update=function(t){if(this.inputSource&&"gaze"!==this.inputSource.targetRayMode&&(this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(0,1,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color)),this.inputSource&&this.inputSource.hand)for(var i=0;i<this.joints.length;i++){var e=this.joints[i].joint,o=2*e.radius;this.joints[i].setLocalScale(o,o,o),this.joints[i].setPosition(e.getPosition()),this.joints[i].setRotation(e.getRotation())}else this.inputSource&&this.inputSource.grip?(this.modelEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation())):(this.modelEntity.enabled=!1,this.inputSource&&"gaze"!==this.inputSource.targetRayMode||(this.entity.setPosition(this.app.mainCamera.getPosition()),this.entity.setRotation(this.app.mainCamera.getRotation())));this.pick(),this.teleportableEntity?(this.vecB.copy(this.hoverEntity.up).scale(.01),this.vecA.copy(this.hoverPoint).add(this.vecB),this.app.fire("teleport:transform",this.vecA,this.hoverEntity.getRotation()),this.app.fire("teleport:show")):this.app.fire("teleport:hide")};var TeleportCamera=pc.createScript("teleportCamera");TeleportCamera.prototype.initialize=function(){this.app.on("teleport:to",(function(t){this.entity.setPosition(t)}),this)};pc.extend(pc,function(){var FxaaEffect=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return(FxaaEffect=pc.inherits(FxaaEffect,pc.PostEffect)).prototype=pc.extend(FxaaEffect.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:FxaaEffect}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};var Teleport=pc.createScript("teleport");Teleport.prototype.initialize=function(){this.app.on("teleport:show",(function(){this.entity.enabled=!0}),this),this.app.on("teleport:hide",(function(){this.entity.enabled=!1}),this),this.app.on("teleport:transform",(function(t,e){this.entity.setPosition(t),this.entity.setRotation(e)}),this)};var LocatorRings=pc.createScript("locatorRings");LocatorRings.attributes.add("animLength",{type:"number",default:1,title:"Anim Length (secs)"}),LocatorRings.attributes.add("loopGap",{type:"number",default:1,title:"Loop Gap (secs)"}),LocatorRings.attributes.add("yOffsetCurve",{type:"curve",title:"Y Offset Curve"}),LocatorRings.attributes.add("scaleOffsetCurve",{type:"curve",title:"Scale Offset Curve"}),LocatorRings.attributes.add("alphaCurve",{type:"curve",title:"Alpha Curve"}),LocatorRings.prototype.initialize=function(){this._rings=this.entity.findByTag("locator-ring"),this._ringCount=this._rings.length,this._time=0,this._targetScaleY=1,this._setScaleY(.001),this.on("state",this._onStateChanged,this)},LocatorRings.ringPosition=new pc.Vec3,LocatorRings.SCALE_LERP_FACTOR=8,LocatorRings.prototype.update=function(t){var e=this._time/this.animLength,i=LocatorRings.ringPosition;LocatorRings.ringScale;if(e<=1)for(var a=0;a<this._ringCount;++a){var s=(e+1/this._ringCount*a)%1,o=this._rings[a];i.copy(o.getLocalPosition()),i.y=this.yOffsetCurve.value(s),o.setLocalPosition(i);var n=this.scaleOffsetCurve.value(s);o.setLocalScale(n,n,n),pc.util.setEntityAlpha(o,this.alphaCurve.value(s))}this._time=(this._time+t)%(this.animLength+this.loopGap);var r=this.entity.getLocalScale();this._setScaleY(pc.math.lerp(r.y,this._targetScaleY,Math.min(LocatorRings.SCALE_LERP_FACTOR*t,1)))},LocatorRings.prototype._onStateChanged=function(t){t&&(this._setScaleY(.001),this._targetScaleY=1)},LocatorRings.prototype._setScaleY=function(t){var e=this.entity.getLocalScale();e.y=t,this.entity.setLocalScale(e)};var SAMPLE_COUNT=15;function computeGaussian(t,e){return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-t*t/(2*e*e))}function calculateBlurValues(t,e,o,s,i){t[0]=computeGaussian(0,i),e[0]=0,e[1]=0;var r,l,a=t[0];for(r=0,l=Math.floor(SAMPLE_COUNT/2);r<l;r++){var u=computeGaussian(r+1,i);t[2*r]=u,t[2*r+1]=u,a+=2*u;var h=2*r+1.5;e[4*r]=o*h,e[4*r+1]=s*h,e[4*r+2]=-o*h,e[4*r+3]=-s*h}for(r=0,l=t.length;r<l;r++)t[r]/=a}function BloomEffect(t){pc.PostEffect.call(this,t);var e={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+t.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),r=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(t,{attributes:e,vshader:o,fshader:s}),this.blurShader=new pc.Shader(t,{attributes:e,vshader:o,fshader:i}),this.combineShader=new pc.Shader(t,{attributes:e,vshader:o,fshader:r}),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var t;if(this.targets)for(t=0;t<this.targets.length;t++)this.targets[t].destroyTextureBuffers(),this.targets[t].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(t){var e,o=t.colorBuffer.width,s=t.colorBuffer.height;if(o!==this.width||s!==this.height)for(this.width=o,this.height=s,this._destroy(),e=0;e<2;e++){var i=new pc.Texture(this.device,{name:"Bloom Texture"+e,format:pc.PIXELFORMAT_R8_G8_B8_A8,width:o>>1,height:s>>1,mipmaps:!1});i.minFilter=pc.FILTER_LINEAR,i.magFilter=pc.FILTER_LINEAR,i.addressU=pc.ADDRESS_CLAMP_TO_EDGE,i.addressV=pc.ADDRESS_CLAMP_TO_EDGE,i.name="pe-bloom";var r=new pc.RenderTarget({name:"Bloom Render Target "+e,colorBuffer:i,depth:!1});this.targets.push(r)}},Object.assign(BloomEffect.prototype,{render:function(t,e,o){this._resize(t);var s=this.device,i=s.scope;i.resolve("uBloomThreshold").setValue(this.bloomThreshold),i.resolve("uBaseTexture").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),i.resolve("uBlurWeights[0]").setValue(this.sampleWeights),i.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),i.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),i.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),i.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),i.resolve("uBaseTexture").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity_Day",{type:"number",default:1,min:0,title:"Intensity_Day"}),Bloom.attributes.add("bloomIntensity_Night",{type:"number",default:1,min:0,title:"Intensity_Night"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount_Day",{type:"number",default:4,min:1,title:"Blur amount_Day"}),Bloom.attributes.add("blurAmount_Night",{type:"number",default:4,min:1,title:"Blur amount_Night"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount_Day,this.effect.bloomIntensity=this.bloomIntensity_Day;var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("attr",(function(t,e){this.effect[t]=e}),this),this.app.on("phase:start",(function(t){4==t?(this.effect.bloomIntensity=this.bloomIntensity_Day,this.effect.blurAmount=this.blurAmount_Day):2==t&&(this.effect.bloomIntensity=this.bloomIntensity_Night,this.effect.blurAmount=this.blurAmount_Night)}),this),this.app.on("phase:now",(function(t,e){1==e?(this.effect.bloomIntensity=pc.math.lerp(this.bloomIntensity_Day,this.bloomIntensity_Night,t),this.effect.blurAmount=pc.math.lerp(this.blurAmount_Day,this.blurAmount_Night,t)):3==e&&(this.effect.bloomIntensity=pc.math.lerp(this.bloomIntensity_Night,this.bloomIntensity_Day,t),this.effect.blurAmount=pc.math.lerp(this.blurAmount_Night,this.blurAmount_Day,t))}),this),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect),this._destroy()}))};var ClipPlane=pc.createScript("clipPlane");ClipPlane.attributes.add("clipPlaneChunk",{title:"Clip Plane Shader",type:"asset",assetType:"shader",description:"Shader that implements clip plane logic"}),ClipPlane.prototype.initialize=function(){this.device=this.app.graphicsDevice,this.position=new pc.Vec3(0,0,0),this.normal=new pc.Vec3(0,1,0),this.planeDataF32=new Float32Array(4),pc.shaderChunks.startPS=this.clipPlaneChunk.resource,this.clipPlaneChunk.on("load",(function(){pc.shaderChunks.startPS=this.clipPlaneChunk.resource}),this),this.on("disable",(function(){this.device.scope.resolve("clip_enabled").setValue(0)})),this.on("enable",(function(){this.device.scope.resolve("clip_enabled").setValue(1)})),this.app.on("clipPlane:set",this.updateClipPlane,this),this.app.on("clipPlane:enable",(function(){this.enabled=!0}),this),this.app.on("clipPlane:disable",(function(){this.enabled=!1}),this),this.updateClipPlane(this.position,this.normal),this.enabled=!1},ClipPlane.prototype.updateClipPlane=function(e,i){this.enabled=!0;var t=this.position.copy(e),a=this.normal.copy(i);this.planeDataF32[0]=a.x,this.planeDataF32[1]=a.y,this.planeDataF32[2]=a.z,this.planeDataF32[3]=-(a.x*t.x+a.y*t.y+a.z*t.z),this.device.scope.resolve("clip_plane").setValue(this.planeDataF32),this.device.scope.resolve("clip_enabled").setValue(1)};var Test=pc.createScript("test");Test.prototype.update=function(t){this.app.fire("clipPlane:set",this.entity.getPosition(),this.entity.up)};var CallPhase=pc.createScript("callPhase");CallPhase.attributes.add("speed",{type:"json",title:"Speed per State",description:"Speed for each State",schema:[{name:"fst",type:"number",default:1},{name:"snd",type:"number",default:1},{name:"trd",type:"number",default:1},{name:"pth",type:"number",default:1},{name:"fth",type:"number",default:1}]}),CallPhase.prototype.initialize=function(){this.phase=1,this.counter=0,this.active=1,this.statecounter=4,this.app.on("movestop",(function(){this.active=1-this.active,this.preactive=this.active}),this)},CallPhase.prototype.update=function(t){this.alpha+=t,this.phase+=this.active*Object.values(this.speed)[this.statecounter]*t,this.phase>=1&&(this.phase=1),this.app.fire("phase:now",e=this.phase,l=this.statecounter),this.phase>=1&&(this.phase=0,this.statecounter>=4?(this.changePhase(),this.statecounter=0):this.statecounter+=1,this.app.fire("phase:start",l=this.statecounter))},CallPhase.prototype.changePhase=function(t){this.counter+=1;let e=this.counter%6;this.app.fire(String(e)+"phase:Run"),this.phase=0};var RoofPlanChanger=pc.createScript("roofPlanChanger");RoofPlanChanger.attributes.add("baseRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("zeroRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("firstRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("secondRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("thirdRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("fourthRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("fifthRoofCoord",{type:"asset"}),RoofPlanChanger.attributes.add("whiteMat",{type:"asset",assetType:"material"}),RoofPlanChanger.attributes.add("blueMat",{type:"asset",assetType:"material"}),RoofPlanChanger.attributes.add("yscale",{default:1,type:"number"}),RoofPlanChanger.attributes.add("moveDelay",{type:"json",title:"DelayConfig",description:"delay configuration",schema:[{name:"delay",type:"number",default:.2},{name:"threshold",type:"number",default:.5},{name:"gounder",type:"number",default:-100}]}),RoofPlanChanger.prototype.initialize=function(){this.baseAsset=this.readAsset(x=this.baseRoofCoord),this.preAsset=this.readAsset(x=this.zeroRoofCoord),this.nowAsset=this.readAsset(x=this.zeroRoofCoord);for(let e in Object.keys(this.baseAsset)){let t=Object.keys(this.baseAsset)[e].replace("{","").replace("}","").replaceAll(" ","").split(","),o=new pc.Entity;o.name=Object.keys(this.baseAsset)[e],o.pos=t,o.addComponent("render",{type:"box"}),this.matAssign(o);const s=e;o.delay=Math.random(s)*this.moveDelay.delay,o.setLocalScale(1,this.yscale,1),this.nowAsset[o.name]?o.setLocalPosition(t[0],t[1],-1*parseFloat(t[2])):o.setLocalPosition(t[0],parseFloat(t[1])+this.moveDelay.gounder,-1*parseFloat(t[2])),this.entity.addChild(o),null==this.assetList?this.assetList=[o]:this.assetList.push(o)}const e=this;this.app.on("0phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.zeroRoofCoord),console.log("0")})),this.app.on("1phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.firstRoofCoord),console.log("1")})),this.app.on("2phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.secondRoofCoord),console.log("2")})),this.app.on("3phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.thirdRoofCoord),console.log("3")})),this.app.on("4phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.fourthRoofCoord),console.log("4")})),this.app.on("5phase:Run",(function(){e.preAsset=e.nowAsset,e.nowAsset=e.readAsset(x=e.fifthRoofCoord),console.log("5")})),this.app.on("phase:now",(function(t,o){for(let s in e.assetList){const a=e.assetList[s];let n=t-e.assetList[s].delay;n<0&&(n=0);let r=0;1==o&null!=e.preAsset[a.name]?(r=n<=e.moveDelay.threshold?e.easeInOutSine(n/e.moveDelay.threshold)*e.moveDelay.gounder:e.moveDelay.gounder,a.setLocalPosition(parseFloat(a.pos[0]),parseFloat(a.pos[1])+r,-1*parseFloat(a.pos[2]))):3==o&null!=e.nowAsset[a.name]&&(n<=e.moveDelay.threshold&&(r=(1-e.easeInOutSine(n/e.moveDelay.threshold))*e.moveDelay.gounder),a.setLocalPosition(parseFloat(a.pos[0]),parseFloat(a.pos[1])+r,-1*parseFloat(a.pos[2])))}})),this.app.on("phase:start",(function(t){2==t&&e.run()}))},RoofPlanChanger.prototype.update=function(e){},RoofPlanChanger.prototype.readAsset=function(e){const t="{"+e._resources[0]+"}";return JSON.parse(t)},RoofPlanChanger.prototype.matAssign=function(e){"T"==this.nowAsset[e.name]?e.render.material=this.whiteMat._resources[0]:e.render.material=this.blueMat._resources[0]},RoofPlanChanger.prototype.run=function(e){for(let e in this.assetList)this.matAssign(this.assetList[e])},RoofPlanChanger.prototype.easeInback=function(e){const t=1.70158;return 2.70158*e*e*e-t*e*e},RoofPlanChanger.prototype.easeOutback=function(e){const t=1.70158;return 1+2.70158*Math.pow(e-1,3)+t*Math.pow(e-1,2)},RoofPlanChanger.prototype.lerp=function(e,t,o){return e+(t-e)*o},RoofPlanChanger.prototype.easeInOutSine=function(e){return-(Math.cos(Math.PI*e)-1)/2};var WallPlanChanger=pc.createScript("wallPlanChanger");WallPlanChanger.attributes.add("changeWallCoord",{type:"asset"}),WallPlanChanger.attributes.add("timeRatio",{type:"json",title:"Time Ratio for Walls",description:"defines wall movement per stage",schema:[{name:"fstratio",type:"number",default:3},{name:"sndratio",type:"number",default:4},{name:"trdratio",type:"number",default:3}]}),WallPlanChanger.prototype.initialize=function(){this.asset=this.readAsset(x=this.changeWallCoord),this.phaseNow=0;const t=this.timeRatio.fstratio+this.timeRatio.sndratio+this.timeRatio.trdratio,s=this.timeRatio.fstratio/t,e=this.timeRatio.sndratio/t;this.timeRatio.trdratio;this.moveasset(1),this.app.on("0phase:Run",(function(){this.phaseNow=0}),this),this.app.on("1phase:Run",(function(){this.phaseNow=1}),this),this.app.on("2phase:Run",(function(){this.phaseNow=2}),this),this.app.on("3phase:Run",(function(){this.phaseNow=3}),this),this.app.on("4phase:Run",(function(){this.phaseNow=4}),this),this.app.on("5phase:Run",(function(){this.phaseNow=5}),this);const a=.1*Math.random(this.entity.getLocalPosition().x),i=.1*Math.random(this.entity.getLocalPosition().z),n=1+a+i;this.app.on("phase:now",(function(t,o){if([1,2,3].includes(o)){let h=0;if(1==o)h=pc.math.lerp(0,s,t);else if(2==o)h=pc.math.lerp(s,s+e,t);else{if(3!=o)return;h=pc.math.lerp(s+e,1,t)}let l=h;l=h<a/n?0:h>1-i/n?1:(h-a/n)/(1-(a+i)/n),this.moveasset(this.easeCustom4(l))}else 4==o?this.moveasset(1-.001*t):this.moveasset(0-.001*t)}),this)},WallPlanChanger.prototype.update=function(t){},WallPlanChanger.prototype.moveasset=function(t){let s=0;s=0==this.phaseNow?5:this.phaseNow-1;const e=this.lerp(this.asset[s].xsize,this.asset[this.phaseNow].xsize,t),a=this.lerp(this.asset[s].ysize,this.asset[this.phaseNow].ysize,t),i=this.lerp(this.asset[s].zsize,this.asset[this.phaseNow].zsize,t),n=this.lerp(this.asset[s].xloc,this.asset[this.phaseNow].xloc,t),o=this.lerp(this.asset[s].yloc,this.asset[this.phaseNow].yloc,t),h=-this.lerp(this.asset[s].zloc,this.asset[this.phaseNow].zloc,t);this.entity.collision.halfExtents=new pc.Vec3(e/2,a/2,i/2),this.entity.setLocalScale(e,a,i),this.entity.setLocalPosition(n,o,h)},WallPlanChanger.prototype.readAsset=function(t){let s=[];const e=t._resources[0].replaceAll("},{","}+{").replaceAll("\r","").replaceAll("\n","").split("+");for(let t in e)s.push(JSON.parse(e[t]));return s},WallPlanChanger.prototype.lerp=function(t,s,e){return t+(s-t)*e},WallPlanChanger.prototype.easeCustom1=function(t){const s=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,.001*(t-.5))*Math.sin((20*t-11.125)*s)/2:Math.pow(2,-.001*(t-.5))*Math.sin((20*t-11.125)*s)/2+1},WallPlanChanger.prototype.easeCustom2=function(t){const s=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-s)/2:(Math.pow(2*t-2,2)*((s+1)*(2*t-2)+s)+2)/2},WallPlanChanger.prototype.easeInOutSine=function(t){return-(Math.cos(Math.PI*t)-1)/2},WallPlanChanger.prototype.easeCustom3=function(t){return t<.25?-1*this.easeInOutSine(4*t):t>=.25&t<=.75?3*this.easeInOutSine(2*t-.5)-1:2-1*this.easeInOutSine(4*t-3)},WallPlanChanger.prototype.easeCustom4=function(t){return t<.25?-.5*this.easeCustom3(4*t):t>=.25&t<=.75?2*this.easeCustom3(2*t-.5)-.5:1.5-.5*this.easeCustom3(4*t-3)};class AmmoDebugDrawer{constructor(e={}){if(!window.Ammo)return void console.warn("Warning! Trying to initialize Ammo Debug Drawer without Ammo lib in the project. Aborting.");const t=pc.Application.getApplication(),o=t.scene.layers,n=this,r=e.layer||o.getLayerByName("Debug Draw")||o.getLayerById(pc.LAYERID_UI),{entity:s,distance:i,ignorePartials:a}=e.limit||{},c=new AmmoDebugDrawer.Pool,d=new pc.Vec3,u=new pc.Vec3;new pc.Vec3;let l=1,p=!1;const m=new Ammo.DebugDrawer;m.drawLine=function drawLine(e,t,o){const n=Ammo.wrapPointer(e,Ammo.btVector3),r=Ammo.wrapPointer(t,Ammo.btVector3),l=Ammo.wrapPointer(o,Ammo.btVector3);if(s){d.set(n.x(),n.y(),n.z()),u.set(r.x(),r.y(),r.z());const e=s.getPosition(),t=e.distance(d),o=e.distance(u);(t<i&&o<i||s&&!a&&(t<i||o<i))&&(c.pushPos(d.x,d.y,d.z,u.x,u.y,u.z),c.pushColor(l.x(),l.y(),l.z(),1,l.x(),l.y(),l.z(),1))}else c.pushPos(n.x(),n.y(),n.z(),r.x(),r.y(),r.z()),c.pushColor(l.x(),l.y(),l.z(),1,l.x(),l.y(),l.z(),1)}.bind(this),m.drawContactPoint=function drawContactPoint(e,t,o,n,r){const s=Ammo.wrapPointer(e,Ammo.btVector3),i=Ammo.wrapPointer(t,Ammo.btVector3),a=Ammo.wrapPointer(r,Ammo.btVector3),d=s.x(),u=s.y(),l=s.z();c.pushPos(d,u,l,d+.5*i.x(),u+.5*i.y(),l+.5*i.z()),c.pushColor(a.x(),a.y(),a.z(),1,a.x(),a.y(),a.z(),1)}.bind(this),m.reportErrorWarning=function reportErrorWarning(e){}.bind(this),m.draw3dText=function draw3dText(e,t){}.bind(this),m.setDebugMode=function setDebugMode(e){l=e}.bind(this),m.getDebugMode=function getDebugMode(){return l}.bind(this),m.enable=function enable(){n.enabled=!0}.bind(this),m.disable=disable.bind(this),m.update=update.bind(this);const b=t.systems.rigidbody.dynamicsWorld;function clear(){c.clear()}function disable(){n.enabled=!1}function update(){p&&b.debugDrawWorld()}function postUpdate(){p&&(!function draw(){try{c.entries.forEach((e=>{t.drawLineArrays(e.positions,e.colors,!1,r)}))}catch(e){console.warn("Error drawing debug lines",e),disable()}}(),clear())}b.setDebugDrawer(m),n.clear=clear,n.toggle=function toggle(){n.enabled=!p},Object.defineProperties(n,{enabled:{get:()=>p,set:e=>{p=e,p?(t.systems.on("update",update,n),t.systems.on("postUpdate",postUpdate,n)):(t.systems.off("update",update,n),t.systems.off("postUpdate",postUpdate,n),clear())}},mode:{get:()=>l,set:e=>{l=e}}})}}AmmoDebugDrawer.Pool=class Pool{constructor(){const e=this,t=new Map;let o=0;function _add(e){const o={positions:[],colors:[]};return t.set(e,o),o}function _getEntry(e,n){let r=t.get(o);return r[e].length+n>64e3&&(r=_add(++o)),r}t.set(o,{positions:[],colors:[]}),e.entries=t,e.clear=function clear(){t.clear(),o=0,_add(o)},e.pushColor=function pushColor(e,t,o,n,r,s,i,a){_getEntry("colors",8).colors.push(e,t,o,n,r,s,i,a)},e.pushPos=function pushPos(e,t,o,n,r,s){_getEntry("positions",6).positions.push(e,t,o,n,r,s)},_add(o)}};class Example extends pc.ScriptType{initialize(){const e=this.app.root.findByName("Camera");new AmmoDebugDrawer({limit:{entity:e,distance:50}}).enabled=!0,this.app.on("ui:mode-select",this.changeMode,this),this.cubeIndex=0,this.allSpawned=!1,this.reset()}reset(){this.time=0,this.delay=pc.math.random(0,1)}changeMode(e){this.renderer&&(this.renderer.mode=e)}}pc.registerScript(Example,"example");var FloorPlanChanger=pc.createScript("floorPlanChanger");FloorPlanChanger.attributes.add("baseFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("zeroFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("firstFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("secondFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("thirdFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("fourthFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("fifthFloorCoord",{type:"asset"}),FloorPlanChanger.attributes.add("speed",{type:"number"}),FloorPlanChanger.attributes.add("whiteMat",{type:"asset",assetType:"material"}),FloorPlanChanger.attributes.add("blueMat",{type:"asset",assetType:"material"}),FloorPlanChanger.attributes.add("yscale",{default:1,type:"number"}),FloorPlanChanger.attributes.add("moveDelay",{type:"json",title:"DelayConfig",description:"delay configuration",schema:[{name:"delay",type:"number",default:.2},{name:"threshold",type:"number",default:.5},{name:"gounder",type:"number",default:-100}]}),FloorPlanChanger.prototype.initialize=function(){this.baseAsset=this.readAsset(x=this.baseFloorCoord),this.nowAsset=this.readAsset(x=this.zeroFloorCoord);for(const e in Object.keys(this.baseAsset)){const t=Object.keys(this.baseAsset)[e].replace("{","").replace("}","").replaceAll(" ","").split(","),o=new pc.Entity;o.name=Object.keys(this.baseAsset)[e],o.pos=t,o.addComponent("render",{type:"box"}),o.render.material=this.whiteMat._resources[0];const s=new pc.Entity;s.addComponent("render",{type:"plane"}),s.render.material=this.blueMat._resources[0],s.setLocalPosition(0,.375,0),o.addChild(s);const a=new pc.Entity;a.addComponent("render",{type:"plane"}),a.render.material=this.blueMat._resources[0],a.setLocalPosition(0,-.375,0),o.addChild(a),this.matAssign(o);const n=e;o.delay=Math.random(n)*this.moveDelay.delay,o.setLocalScale(1,this.yscale,1),this.nowAsset[o.name]?o.setLocalPosition(t[0],t[1],-1*parseFloat(t[2])):o.setLocalPosition(t[0],parseFloat(t[1])+this.moveDelay.gounder,-1*parseFloat(t[2])),this.entity.addChild(o),null==this.assetList?this.assetList=[o]:this.assetList.push(o)}const e=this;this.app.on("0phase:Run",(function(){e.nowAsset=e.readAsset(x=e.zeroFloorCoord),console.log("0")})),this.app.on("1phase:Run",(function(){e.nowAsset=e.readAsset(x=e.firstFloorCoord),console.log("1")})),this.app.on("2phase:Run",(function(){e.nowAsset=e.readAsset(x=e.secondFloorCoord),console.log("2")})),this.app.on("3phase:Run",(function(){e.nowAsset=e.readAsset(x=e.thirdFloorCoord),console.log("3")})),this.app.on("4phase:Run",(function(){e.nowAsset=e.readAsset(x=e.fourthFloorCoord),console.log("4")})),this.app.on("5phase:Run",(function(){e.nowAsset=e.readAsset(x=e.fifthFloorCoord),console.log("5")})),this.app.on("phase:now",(function(t,o){for(let s in e.assetList){const a=e.assetList[s];if(e.nowAsset[a.name]){let n=t-e.assetList[s].delay;n<0&&(n=0);let r=0;1==o?(r=n<=e.moveDelay.threshold?e.easeInOutSine(n/e.moveDelay.threshold)*e.moveDelay.gounder:e.moveDelay.gounder,a.setLocalPosition(parseFloat(a.pos[0]),parseFloat(a.pos[1])+r,-1*parseFloat(a.pos[2]))):3==o&&(n<=e.moveDelay.threshold&&(r=(1-e.easeInOutSine(n/e.moveDelay.threshold))*e.moveDelay.gounder),a.setLocalPosition(parseFloat(a.pos[0]),parseFloat(a.pos[1])+r,-1*parseFloat(a.pos[2])))}}})),this.app.on("phase:start",(function(t){2==t&&e.run()})),this.wave=0},FloorPlanChanger.prototype.update=function(e){this.wave+=this.speed*e,this.wave>=10&&(this.wave=0),this.blueMat._resources[0]._normalMapOffset.y=this.wave,this.blueMat._resources[0].update()},FloorPlanChanger.prototype.readAsset=function(e){const t="{"+e._resources[0]+"}";return JSON.parse(t)},FloorPlanChanger.prototype.matAssign=function(e){if("T"==this.nowAsset[e.name]){e.render.enabled=!0;for(let t in e.children)e.children[t].enabled=!1}else{e.render.enabled=!1;for(let t in e.children)e.children[t].enabled=!0}},FloorPlanChanger.prototype.run=function(e){for(let e in this.assetList)this.matAssign(this.assetList[e])},FloorPlanChanger.prototype.easeInback=function(e){const t=1.70158;return 2.70158*e*e*e-t*e*e},FloorPlanChanger.prototype.easeOutback=function(e){const t=1.70158;return 1+2.70158*Math.pow(e-1,3)+t*Math.pow(e-1,2)},FloorPlanChanger.prototype.lerp=function(e,t,o){return e+(t-e)*o},FloorPlanChanger.prototype.easeInOutSine=function(e){return-(Math.cos(Math.PI*e)-1)/2};var ScaleBaseTile=pc.createScript("scaleBaseTile");ScaleBaseTile.attributes.add("tile",{type:"json",title:"tile Ratio for Walls",description:"defines ratio per scale",schema:[{name:"u",type:"number",default:3},{name:"v",type:"number",default:3}]}),ScaleBaseTile.prototype.initialize=function(){},ScaleBaseTile.prototype.update=function(e){this.entity.getLocalScale().x>this.entity.getLocalScale().z?this.entity.render.material._diffuseMapTiling.x=Math.abs(this.entity.getLocalScale().x)/this.tile.u:this.entity.render.material._diffuseMapTiling.x=Math.abs(this.entity.getLocalScale().z)/this.tile.u,this.entity.render.material._diffuseMapTiling.y=Math.abs(this.entity.getLocalScale().y)/this.tile.v,this.entity.render.material.update()};var MovementOpacity=pc.createScript("movementOpacity");MovementOpacity.attributes.add("strength",{default:1,type:"number"}),MovementOpacity.prototype.initialize=function(){this.entity.render.material._diffuse=new pc.Color(.999,.999,.999,1),this.entity.render.material._emissiveIntensity=0,this.app.on("phase:now",(function(t,e){1==e?(this.entity.render.material._emissiveIntensity=(t-.001)*this.strength,this.entity.render.material._diffuse=new pc.Color(1.001-t,1.001-t,1.001-t,1)):3==e&&(this.entity.render.material._emissiveIntensity=(1-t)*this.strength,this.entity.render.material._diffuse=new pc.Color(t+.001,t+.001,t+.001,1))}),this)},MovementOpacity.prototype.update=function(t){};var SkyChanger=pc.createScript("skyChanger");SkyChanger.prototype.initialize=function(){this.app.scene.skyboxIntensity=1.999,this.app.on("phase:start",(function(t){1==t?this.app.scene.skyboxIntensity=.001:4==t&&(this.app.scene.skyboxIntensity=1.999)}),this)},SkyChanger.prototype.update=function(t){};var FurnChanger=pc.createScript("furnChanger");FurnChanger.attributes.add("changeWallCoord",{type:"asset"}),FurnChanger.attributes.add("timeRatio",{type:"json",title:"Time Ratio for Walls",description:"defines wall movement per stage",schema:[{name:"fstratio",type:"number",default:3},{name:"sndratio",type:"number",default:4},{name:"trdratio",type:"number",default:3}]}),FurnChanger.prototype.initialize=function(){this.asset=this.readAsset(x=this.changeWallCoord),this.phaseNow=0;const t=this.timeRatio.fstratio+this.timeRatio.sndratio+this.timeRatio.trdratio;this.timeRatio.fstratio,this.timeRatio.sndratio,this.timeRatio.trdratio;this.moveasset(1),this.app.on("0phase:Run",(function(){this.phaseNow=0}),this),this.app.on("1phase:Run",(function(){this.phaseNow=1}),this),this.app.on("2phase:Run",(function(){this.phaseNow=2}),this),this.app.on("3phase:Run",(function(){this.phaseNow=3}),this),this.app.on("4phase:Run",(function(){this.phaseNow=4}),this),this.app.on("5phase:Run",(function(){this.phaseNow=5}),this),this.app.on("phase:start",(function(t){1==t&&(this.entity.model.enabled=!1,this.entity.children[0].enabled=!1),4==t&&(this.entity.model.enabled=!0,this.entity.children[0].enabled=!0,this.moveasset(1))}),this)},FurnChanger.prototype.update=function(t){},FurnChanger.prototype.moveasset=function(t){let s=0;s=0==this.phaseNow?5:this.phaseNow-1;const e=this.lerp(this.asset[s].xrot,this.asset[this.phaseNow].xrot,t),i=this.lerp(this.asset[s].yrot,this.asset[this.phaseNow].yrot,t),h=this.lerp(this.asset[s].zrot,this.asset[this.phaseNow].zrot,t),a=this.lerp(this.asset[s].xloc,this.asset[this.phaseNow].xloc,t),n=this.lerp(this.asset[s].yloc,this.asset[this.phaseNow].yloc,t),o=-this.lerp(this.asset[s].zloc,this.asset[this.phaseNow].zloc,t);this.entity.setLocalEulerAngles(e,i,h),this.entity.setLocalPosition(a,n,o),this.entity.children[0].collision.halfExtents=new pc.Vec3(this.entity.children[0].collision.halfExtents.x,this.entity.children[0].collision.halfExtents.y,this.entity.children[0].collision.halfExtents.z)},FurnChanger.prototype.readAsset=function(t){let s=[];const e=t._resources[0].replaceAll("},{","}+{").replaceAll("\r","").replaceAll("\n","").split("+");for(let t in e)s.push(JSON.parse(e[t]));return s},FurnChanger.prototype.lerp=function(t,s,e){return t+(s-t)*e},FurnChanger.prototype.easeCustom=function(t){return-(Math.cos(Math.PI*t)-1)/2};pc.extend(pc,function(){var BrightnessContrastEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return(BrightnessContrastEffect=pc.inherits(BrightnessContrastEffect,pc.PostEffect)).prototype=pc.extend(BrightnessContrastEffect.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:BrightnessContrastEffect}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var WaterPlanChanger=pc.createScript("waterPlanChanger");WaterPlanChanger.attributes.add("changewaterCoord",{type:"asset"}),WaterPlanChanger.attributes.add("blueMat",{type:"asset",assetType:"material"}),WaterPlanChanger.attributes.add("speed",{type:"number"}),WaterPlanChanger.prototype.initialize=function(){this.asset=this.readAsset(x=this.changewaterCoord),this.phaseNow=0,this.matCopy=this.blueMat._resources[0].clone(),this.entity.render.material=this.matCopy,this.wave=0,this.moveasset(1),this.app.on("0phase:Run",(function(){this.phaseNow=0}),this),this.app.on("1phase:Run",(function(){this.phaseNow=1}),this),this.app.on("2phase:Run",(function(){this.phaseNow=2}),this),this.app.on("3phase:Run",(function(){this.phaseNow=3}),this),this.app.on("4phase:Run",(function(){this.phaseNow=4}),this),this.app.on("5phase:Run",(function(){this.phaseNow=5}),this),this.app.on("phase:start",(function(t){1==t&&(this.entity.render.enabled=!1,this.entity.collision.enabled=!1),4==t&&(this.entity.render.enabled=!0,this.entity.collision.enabled=!0,this.moveasset(1))}),this)},WaterPlanChanger.prototype.update=function(t){this.wave+=this.speed*t,this.wave>=10&&(this.wave=0),this.blueMat._resources[0]._normalMapOffset.y=this.wave,this.entity.render.material._normalMapOffset.y=this.wave,this.blueMat._resources[0].update(),this.entity.render.material.update()},WaterPlanChanger.prototype.moveasset=function(t){let e=0;e=0==this.phaseNow?5:this.phaseNow-1;const s=this.lerp(this.asset[e].xsize,this.asset[this.phaseNow].xsize,t),a=(this.lerp(this.asset[e].ysize,this.asset[this.phaseNow].ysize,t),this.lerp(this.asset[e].zsize,this.asset[this.phaseNow].zsize,t)),i=this.lerp(this.asset[e].xloc,this.asset[this.phaseNow].xloc,t),h=this.lerp(this.asset[e].yloc,this.asset[this.phaseNow].yloc,t),n=-this.lerp(this.asset[e].zloc,this.asset[this.phaseNow].zloc,t);this.entity.setLocalScale(s,.75,a),this.entity.setLocalPosition(i,h,n),this.entity.collision.halfExtents=new pc.Vec3(s/2,2.5,a/2),this.entity.render.material._normalMapTiling.x=s,this.entity.render.material._normalMapTiling.y=a},WaterPlanChanger.prototype.readAsset=function(t){let e=[];const s=t._resources[0].replaceAll("},{","}+{").replaceAll("\r","").replaceAll("\n","").split("+");for(let t in s)e.push(JSON.parse(s[t]));return e},WaterPlanChanger.prototype.lerp=function(t,e,s){return t+(e-t)*s},WaterPlanChanger.prototype.easeCustom=function(t){return-(Math.cos(Math.PI*t)-1)/2};var TestForAuto=pc.createScript("testForAuto");TestForAuto.prototype.initialize=function(){console.log(pc.shaderChunks)},TestForAuto.prototype.update=function(t){};var DisableAtnight=pc.createScript("disableAtnight");DisableAtnight.prototype.initialize=function(){this.app.on("phase:start",(function(t){1==t&&(this.entity.render.enabled=!1),4==t&&(this.entity.render.enabled=!0)}),this)},DisableAtnight.prototype.update=function(t){};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","#application-splash-wrapper {","    position: relative;","    margin: 0 auto;","    height: 100%;","    width: 100%;","    background-color: #1f1f1f;","}","#application-splash {","    position: relative;","    top: calc(50% - 96px);","    width: 250px;","    left: calc(50% - 125px);","}","#application-splash img {","    width: 100%;","}","#progress-bar-container {","    margin: 20px 0 auto 0;","    height: 2px;","    width: 100%;","    background-color: #000000;","}","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #ffffff;","}","@media (max-width: 480px) {","    #application-splash {","        position: relative;","        top: calc(50% - 65px);","        width: 170px;","        left: calc(50% - 85px);","    }","    #progress-bar-container {","        margin: 13px 0 auto 0;","        height: 2px;","        width: 100%;","        background-color: #000000;","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://ersatz.kr/works/logo.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var Check=pc.createScript("check");Check.prototype.initialize=function(){this.timer=0,this.active=1},Check.prototype.update=function(t){this.timer+=t,1==this.active&this.timer>=2&pc.app.stats.frame.fps<=15&&(this.disableshadow(),this.active=0)},Check.prototype.disableshadow=function(t){this.entity.root.findByName("029_Ground").enabled=0,this.entity.root.findByName("Directional Light").light.shadowIntensity=0,this.entity.root.findByName("Directional Light").light.shadowUpdateMode=0,console.log(this.entity.root.findByName("Directional Light").light)};
